{
  "$schema": "http://json-schema.org/draft-04/schema#",
  "title": "HydroShootParameters",
  "description": "The schema for HydroShoot parameters",
  "type": "object",
  "properties": {
    "simulation": {
      "type": "object",
      "description": "Simulation configuration parameters",
      "properties": {
        "sdate": {
          "type": "string",
          "format": "date_time",
          "description": "starting date of the simulation"
        },
        "edate": {
          "type": "string",
          "format": "date_time",
          "description": "end date of the simulation"
        },
        "latitude": {
          "type": "number",
          "description": "[decimal degrees] latitude of location"
        },
        "longitude": {
          "type": "number",
          "description": "[decimal degrees] longitude of location"
        },
        "elevation": {
          "type": "number",
          "description": "[m.a.s.l] latitude of location"
        },
        "tzone": {
          "type": "string",
          "description": "Area/Location timezone according to the Olson timezone database"
        },
        "output_index": {
          "type": "string",
          "description": "Index to be added to the name of the simulation outputs folder"
        },
        "unit_scene_length": {
          "type": "string",
          "description": "Unit length of scene elements",
          "enum": ["mm", "cm", "m"]
        },
        "simplified_form_factors": {
          "type": "boolean",
          "description": "`true` to use the simplified form factors method"
        },
        "hydraulic_structure": {
          "type": "boolean",
          "description": "`true` to calculate shoot hydraulic structure: leaf water potential is calculated and used in stomatal conductance model; `false` to use leaf-to-air vapor pressure deficit"
        },
        "negligible_shoot_resistance": {
          "type": "boolean",
          "description": "`true` to omit shoot hydraulic resistance: leaf water potential is equal to soil water potential; `false` to calculate leaf water potential as part of the hydraulic structure"
        },
        "energy_budget": {
          "type": "boolean",
          "description": "`true` to calculate leaf temperature from leaf energy budget; `false` to set leaf temperature equal to air temperature"
        },
        "soil_water_deficit": {
          "type": "boolean",
          "description": "`true` to allow simulating soil water deficit; `false` to prevent soil water from dropping below a given threshold"
        }
      },
      "required": [
        "sdate",
        "edate",
        "latitude",
        "longitude",
        "elevation",
        "tzone",
        "output_index",
        "unit_scene_length",
        "simplified_form_factors",
        "hydraulic_structure",
        "negligible_shoot_resistance",
        "energy_budget",
        "soil_water_deficit"
      ]

    },
    "phenology": {
      "type": "object",
      "description": "Parameters required for calculating cumulative degree-day temperature since budbreak",
      "properties": {
        "emdate": {
          "type": "string",
          "format": "date_time",
          "description": "Observed date of budbreak"
        },
        "t_base": {
          "type": "number",
          "description": "[°C] base temperature for cumulative degree-days calculations",
          "minimum": 0
        }
      },
      "required": [
        "emdate",
        "t_base"
      ]
    },
    "mtg_api": {
      "type": "object",
      "description": "API in order to allow HydroShoot to identify the different shoot hydraulic segments",
      "properties": {
        "collar_label": {
          "type": "string",
          "description": "Label prefix of the collar internode (required to identify the first segment of the hydraulic structure)"
        },
        "leaf_lbl_prefix": {
          "type": "string",
          "description": "Label prefix of the leaf"
        },
        "stem_lbl_prefix": {
          "type": "array",
          "description": "Label prefices of the internodes, petioles, and complex-nodes resulting from pruning over successive years",
          "minItems": 3,
          "maxItems": 3,
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "collar_label",
        "leaf_lbl_prefix",
        "stem_lbl_prefix"
      ]
    },
    "numerical_resolution": {
      "type": "object",
      "description": "Requirements for the numerical resolution of the hydraulic and energy-balance systems",
      "properties": {
        "max_iter": {
          "type": "integer",
          "description": "Maximum number of iterations (for both hydraulic and energy-balance calculations)",
          "minimum": 0,
          "exclusiveMinimum": true,
          "maximum": 200
        },
        "psi_step": {
          "type": "number",
          "description": "Reduction factor to the xylem water potential step value between two consecutive iterations in the case of non convergence",
          "minimum": 0,
          "exclusiveMinimum": true,
          "maximum": 1
        },
        "psi_error_threshold": {
          "type": "number",
          "description": "[MPa] Maximum allowable cumulative squared difference in xylem water potential between two consecutive iterations",
          "minimum": 0
        },
        "t_step": {
          "type": "number",
          "description": "Reduction factor to the leaf temperature step value between two consecutive iterations in the case of non convergence",
          "minimum": 0,
          "exclusiveMinimum": true,
          "maximum": 1
        },
        "t_error_crit": {
          "type": "number",
          "description": "[°C] Maximum allowable cumulative squared difference in leaf temperature between two consecutive iterations",
          "minimum": 0
        }
      },
      "required": [
        "max_iter",
        "psi_step",
        "psi_error_threshold",
        "t_step",
        "t_error_crit"
      ]
    },
    "irradiance": {
      "type": "object",
      "description": "Irradiance interception parameters to be used in the Caribu model (Chelle et al. 1998, Ecol. Model. 111, 75  91)",
      "properties": {
        "E_type": {
          "type": "string",
          "description": "Unit of the irradiance flux density used in the simulation",
          "enum": ["Rg_Watt/m2", "RgPAR_Watt/m2", "PPFD_umol/m2/s"]
        },
        "E_type2": {
          "type": "string",
          "description": "Unit of the desired simulated irradiance flux density output",
          "enum": ["Ei", "Eabs"]
        },
        "opt_prop": {
          "type": "object",
          "description": "Optical properties od scene elements",
          "properties": {
            "SW": {
              "type": "object",
              "description": "Optical properties in the shortwave band",
              "properties": {
                "leaf": {
                  "type": "array",
                  "description": "(reflectance, transmittance) of a single leaf",
                  "items": {
                    "type": "number",
                    "minimum": 0,
                    "maximum": 1
                  },
                  "minItems": 2,
                  "maxItems": 2
                },
                "stem": {
                  "type": "array",
                  "description": "(reflectance, ) of a stem",
                  "items": {
                    "type": "number",
                    "minimum": 0,
                    "maximum": 1
                  },
                  "minItems": 1,
                  "maxItems": 1
                },
                "other": {
                  "type": "array",
                  "description": "(reflectance, transmittance) of a given element",
                  "items": {
                    "type": "number",
                    "minimum": 0,
                    "maximum": 1
                  },
                  "minItems": 2,
                  "maxItems": 2
                }
              },
              "required": [
                "leaf",
                "stem"
              ]
            },
            "LW": {
              "type": "object",
              "description": "Optical properties in the longwave band",
              "properties": {
                "leaf": {
                  "type": "array",
                  "description": "(reflectance, transmittance) of a single leaf",
                  "items": {
                    "type": "number",
                    "minimum": 0,
                    "maximum": 1
                  },
                  "minItems": 2,
                  "maxItems": 2
                },
                "stem": {
                  "type": "array",
                  "description": "(reflectance, ) of a stem",
                  "items": {
                    "type": "number",
                    "minimum": 0,
                    "maximum": 1
                  },
                  "minItems": 1,
                  "maxItems": 1
                },
                "other": {
                  "type": "array",
                  "description": "(reflectance, transmittance) of a given element",
                  "items": {
                    "type": "number",
                    "minimum": 0,
                    "maximum": 1
                  },
                  "minItems": 2,
                  "maxItems": 2
                }
              },
              "required": [
                "leaf",
                "stem"
              ]
            }
          },
          "required": [
            "SW",
            "LW"
          ]
        },
        "scene_rotation": {
          "type": "number",
          "description": "[degrees] Counter clockwise angle between the default X-axis direction (South) and the real direction of X-axis."
        },
        "turtle_format": {
          "type": "string",
          "description": "Irradiance distribution over the celestial dome (sky overcast or uniform overcast)",
          "enum": ["soc", "uoc"]
        },
        "turtle_sectors": {
          "type": "string",
          "description": "String number of turtle sectors",
          "enum": ["16", "46"]
        },
        "icosphere_level": {
          "type": "string",
          "description": "The level of refinement of the dual icosphere."
        }
      },
      "required": [
        "E_type",
        "E_type2",
        "opt_prop",
        "scene_rotation",
        "turtle_format",
        "turtle_sectors",
        "icosphere_level"
      ]
    },
    "energy": {
      "type": "object",
      "description": "Energy exchange paramaters",
      "properties": {
        "solo": {
          "type": "boolean",
          "description": " if `true` calculates energy budget for each element assuming the temperatures of surrounding leaves constant (from previous calculation step), if `false` computes simultaneously all temperatures using `sympy.solvers.nsolve` (**very costly!!!**)"
        },
        "limit": {
          "type": "number",
          "description": "(negative), a threshold below which form factor values are ignored",
          "maximum": 0.0,
          "exclusiveMaximum": true
        },
        "t_cloud": {
          "type": "number",
          "description": "[°C] Cloud temperature"
        },
        "t_sky": {
          "type": "number",
          "description": "[°C] Sky temperature"
        }
      },
      "required": [
        "solo",
        "limit",
        "t_cloud",
        "t_sky"
      ]
    },
    "hydraulic": {
      "type": "object",
      "description": "Parameters of the hydraulic module",
      "properties": {
        "MassConv": {
          "type": "number",
          "description": "[g mol-1] Molar mass of pure water",
          "minimum": 0.0,
          "exclusiveMinimum": true
        },
        "psi_min": {
          "type": "number",
          "description": "[MPa] Minimum allowable xylem water potential",
          "maximum": 0.0
        },
        "Kx_dict": {
          "type": "object",
          "description": "Parameters of the allometric relationship between the diameter of the hydraulic segment and its maximum hydraulic conductivity (K_max=a*D^b)",
          "properties": {
            "a": {
              "type": "number",
              "description": "[kg s-1 m-3 MPa-1] The slope of the allometric relationship",
              "minimum": 0.0,
              "exclusiveMinimum": true
            },
            "b": {
              "type": "number",
              "description": "[-] The power of the allometric relationship",
              "minimum": 0.0,
              "exclusiveMinimum": true
            },
            "min_kmax": {
              "type": "number",
              "description": "[kg s-1 m-3 MPa-1] The minimum allowable (or observed) value of maximum hydraulic conductivity",
              "minimum": 0.0,
              "exclusiveMinimum": true
            }
          },
          "required": [
            "a",
            "b",
            "min_kmax"
          ]
        },
        "par_K_vul": {
          "type": "object",
          "description": "Parameters of the vulnerability function of the hydraulic conductivity",
          "properties": {
            "model": {
              "type": "string",
              "description": "Vulnerability model name",
              "enum": ["misson", "tuzet", "linear"]
            },
            "fifty_cent": {
              "type": "number",
              "description": "[MPa] Water potential at which the conductivity of the hydraulic segment is reduced by 50% reltive to its maximum value",
              "minimum": 0.0
            },
            "sig_slope": {
              "type": "number",
              "description": "Shape parameter controlling the slope of the S-curve"
            }
          },
          "required": [
            "model",
            "fifty_cent",
            "sig_slope"
          ]
        }
      },
      "required": [
        "MassConv",
        "psi_min",
        "Kx_dict",
        "par_K_vul"
      ]
    }
  },
  "required": [
    "simulation",
    "phenology",
    "mtg_api",
    "numerical_resolution",
    "irradiance",
    "energy",
    "hydraulic"
  ]
}
